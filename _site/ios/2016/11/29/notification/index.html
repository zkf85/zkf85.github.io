<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Notifications - Example &middot; Everest
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/main.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
<!-- 
  
  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"> </script>
  <script type="text/x-mathjax-config">
MathJax.Hub.Config({ tex2jax: { inlineMath: [ ['$','$'], ["\\(","\\)"] ], processEscapes: true } });
  </script>
  
</head>
 -->

  <body>

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">

  <br><br><br><br>

    <div class="sidebar-personal-info">
      
      <div class="sidebar-personal-info-section">
        <p>An <strong>iOS developer and designer</strong>. Blogging is good.</p>
      </div>

      
      
      
      <div class="sidebar-personal-info-section">
        <p> Follow me: 
        
        
        
        <a href="https://github.com/zkf85">
          <i class="fa fa-github" aria-hidden="true"></i>
        </a>
        
        
        
        </p>
      </div>
      
    </div>
  </div>

<br><br>

  <nav class="sidebar-nav">

    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="/">
          Home
        </a>

        
      </span>

    
      
      
      

      

      <span class="foldable">
        <a class="sidebar-nav-item " href="/blog/">
          Blog
        </a>

        
          
            
            
            
              <a class="sidebar-nav-item sidebar-nav-item-sub " href="/blog/categories/">
                Categories
              </a>
          
        
          
            
            
            
              <a class="sidebar-nav-item sidebar-nav-item-sub " href="/blog/tags/">
                Tags
              </a>
          
        
      </span>

    
      
      
      

      

      <span class="">
        <a class="sidebar-nav-item " href="/about/">
          About
        </a>

        
      </span>

    

    <!-- <span class="sidebar-nav-item">Currently v1.0.0</span> -->
  </nav>


  <div class="sidebar-item">
    <br><br>
    <p>
    &copy; 2016 Kefeng Zhu. <br>
    All Rights Reserved.
    <br><br>
    Powered by <a href="http://jekyllrb.com">jekyll</a>. 
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <!-- <a href="/" title="Home" title="Everest">
              <img class="masthead-logo" src=""/>
            </a> -->
            <a href="/" title="Home">Everest</a>
            <small>Kefeng's blog</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Notifications - Example</h1>

  <!-- <span class="post-date">29 Nov 2016</span> -->
  <div class="post-date">Tue, 29 Nov 2016 12:30:00 +0800</div>
  <span class="post-tag-kf">
  
  
    <a href="/blog/tags/#ios" class="post-tag">ios</a>
  
    <a href="/blog/tags/#notification" class="post-tag">notification</a>
  
    <a href="/blog/tags/#objective-c" class="post-tag">objective-c</a>
  
  
  </span>
  <hr>
  <article>
    <div class="message">
This is a simple example of how to post and listen to a notification radio.
<br />KF 11/29/2016
</div>

<h2 id="what-is-a-notification">What is a Notification?</h2>
<blockquote>
  <p>Reference: <a href="http://www.informit.com/articles/article.aspx?p=2091958">How Best to Use Delegates and Notifications in Objective-C</a></p>
</blockquote>

<p>Notifications provide a means of broadcasting a message from anywhere to anywhere. The <code class="highlighter-rouge">NSNotification</code> class provides this functionality in Objective-C. It is not strictly a part of the language, but rather the Foundation framework. Instances of NSNotification are broadcast through an <code class="highlighter-rouge">NSNotificationCenter</code>.</p>

<p>Notifications contain a name, an object and a dictionary of metadata. The object and metadata are optional, but the name is required. An object can register with the notification center to receive certain notifications, filtered by name, object or both name and object. Additionally, a selector is passed, which is called when a notification matching the filter is broadcast.
An example of a notification is as follows:</p>

<div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="c1">// Registering as observer from one object
</span><span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span> <span class="nf">addObserver</span><span class="p">:</span><span class="n">self</span>
                                         <span class="nf">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">thingHappened</span><span class="o">:</span><span class="p">)</span>
                                             <span class="n">name</span><span class="o">:</span><span class="n">MyThingHappened</span>
                                           <span class="n">object</span><span class="o">:</span><span class="n">_myObject</span><span class="p">];</span>

<span class="c1">// Posting notification from another object
</span><span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span> <span class="nf">postNotificationName</span><span class="p">:</span><span class="n">MyThingHappened</span>
                                                    <span class="nf">object</span><span class="p">:</span><span class="n">self</span>
                                                  <span class="n">userInfo</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>
</code></pre>
</div>

<p>In this example one object is registering itself as an observer for the MyThingHappened notification, limiting it to when that notification occurs on the exact object, <code class="highlighter-rouge">_myObject</code>. Then, another object is posting that notification with itself as the object and nothing as the metadata dictionary, <code class="highlighter-rouge">userInfo</code>. So in this case, if the object that’s posting the notification is <code class="highlighter-rouge">_myObject</code> from the context of the registering object, then the notification will cause thingHappened: to be called.</p>

<h2 id="why-and-when-to-use-notification">Why and When to Use Notification?</h2>
<h3 id="coupling">Coupling</h3>
<p>Notifications result in loose coupling between objects. The coupling is <strong>loose</strong> because the object sending a notification doesn’t know what is listening to the notification. This loose coupling can be extremely powerful because multiple objects can all register to listen to the same notification, from different parts of an application. However, loose coupling can also make the use of notifications a nightmare to debug, since code can easily become entangled. Following the code paths produced when a notification is broadcast can become a daunting experience.</p>
<h3 id="multiple-listeners">Multiple Listeners</h3>
<p>By design, notifications offer multiple listeners. There can be zero, one or many listeners for any one notification. If you are certain that you’ll need multiple listeners, a notification is the correct route to go down. The instance above of login state handling is a perfect example of this. It’s likely that multiple objects are going to care about login state changing, so a notification makes sense.</p>
<h3 id="is-the-object-known">Is the Object Known?</h3>
<p>Sometimes you don’t actually know the precise object you want to communicate with. An example of such a scenario is the keyboard in iOS, which is a view which is handled entirely by iOS for you.</p>

<h2 id="example-in-my-project---timepocket">Example in my project - TimePocket</h2>
<p>In my project ‘TimePocket’, I use notification to pass <code class="highlighter-rouge">managedObjectContext</code> from <code class="highlighter-rouge">AppDelegate</code> to the <code class="highlighter-rouge">ViewController</code> at a proper time during the life cycle.</p>

<h3 id="create-a-header-file---preparing-for-the-notification">1. Create a Header File - Preparing for the Notification</h3>
<p>Create a header file called <code class="highlighter-rouge">EventDatabaseAvailability.h</code>
In the file add the following two constants:</p>

<div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="cp">#define EventDatabaseAvailabilityNotification @"EventDatabaseAvailabilityNotification"
#define EventDatabaseAvailabilityContext @"Context"
</span></code></pre>
</div>
<h3 id="post-notification">2. Post Notification</h3>
<p>When the initialization of my database is completed, I post my notification there in order to pass the <code class="highlighter-rouge">managedObjectContext</code>.</p>

<p>Post notification code:</p>

<div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="n">NSDictionary</span> <span class="o">*</span><span class="n">userInfo</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">eventDatabaseContext</span> <span class="p">?</span> <span class="p">@{</span> <span class="n">EventDatabaseAvailabilityContext</span> <span class="o">:</span> <span class="n">self</span><span class="p">.</span><span class="n">eventDatabaseContext</span> <span class="p">}</span> <span class="p">:</span> <span class="nb">nil</span><span class="p">;</span>
        <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span> <span class="nf">postNotificationName</span><span class="p">:</span><span class="n">EventDatabaseAvailabilityNotification</span> <span class="nf">object</span><span class="p">:</span><span class="n">self</span> <span class="n">userInfo</span><span class="o">:</span><span class="n">userInfo</span><span class="p">];</span>
</code></pre>
</div>
<h3 id="listen-to-the-notification">3. Listen to the Notification</h3>
<p>In my <code class="highlighter-rouge">ViewController</code>, the notification observer should be added as early as possible in its life cycle. Therefore, it’s added in <code class="highlighter-rouge">awakeFromNib</code>, which is the earliest part in the controller’s life cycle.</p>

<p>Add the notification observer in <code class="highlighter-rouge">- (void)awakeFromNib</code> to listen to the notification.</p>

<div class="language-objc highlighter-rouge"><pre class="highlight"><code><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">awakeFromNib</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">super</span> <span class="nf">awakeFromNib</span><span class="p">];</span>
    <span class="c1">// KF 11/28/2016
</span>    <span class="c1">// Listen to the Notification from AppDelegate
</span>    <span class="p">[[</span><span class="n">NSNotificationCenter</span> <span class="nf">defaultCenter</span><span class="p">]</span>
     <span class="nf">addObserverForName</span><span class="p">:</span><span class="n">EventDatabaseAvailabilityNotification</span>
     <span class="nf">object</span><span class="p">:</span><span class="nb">nil</span>
     <span class="n">queue</span><span class="o">:</span><span class="nb">nil</span>
     <span class="n">usingBlock</span><span class="o">:^</span><span class="p">(</span><span class="n">NSNotification</span> <span class="o">*</span> <span class="n">_Nonnull</span> <span class="n">note</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">self</span><span class="p">.</span><span class="n">managedObjectContext</span> <span class="o">=</span> <span class="n">note</span><span class="p">.</span><span class="n">userInfo</span><span class="p">[</span><span class="nf">EventDatabaseAvailabilityContext</span><span class="p">];</span>
     <span class="p">}];</span>
<span class="p">}</span>
</code></pre>
</div>

<p><br /><br />
<strong><em>KF</em></strong></p>

  </article>
</div>

<div class="related">
  <h3>Related Posts</h3>
  <ul class="related-posts">
    
      <li>
        <h4>
          <a href="/ios/2016/11/28/collection-view-ii/">
            Collection View II - Designing Your Data Source and Delegate
            <small>28 Nov 2016</small>
          </a>
        </h4>
      </li>
    
      <li>
        <h4>
          <a href="/ios/2016/11/24/collection-view-i/">
            Collection View I - Intro & Basics
            <small>24 Nov 2016</small>
          </a>
        </h4>
      </li>
    
      <li>
        <h4>
          <a href="/ios/2016/11/20/core-data/">
            Core Data
            <small>20 Nov 2016</small>
          </a>
        </h4>
      </li>
    
  </ul>
</div>


<div class="comments">
  <h3>Comments</h3>
  <div id="disqus_thread"></div>
  <script>
var disqus_config = function () {
  this.page.url = 'http://localhost:4000/ios/2016/11/29/notification/'; // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = '/ios/2016/11/29/notification'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() {
  var d = document, s = d.createElement('script');
  s.src = '//zkf85githubio.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
})();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if (target === toggle) {
            checkbox.checked = !checkbox.checked;
            e.preventDefault();
          } else if (checkbox.checked && !sidebar.contains(target)) {
            /* click outside the sidebar when sidebar is open */
            checkbox.checked = false;
          }
        }, false);
      })(document);
    </script>
    
  </body>
  
  <script id="dsq-count-scr" src="//zkf85githubio.disqus.com/count.js" async></script>
  
</html>
